#############################################################
##### Configuration File for JWST Coronagraphy Pipeline #####
#############################################################

# TODO: Create readthedocs page that describe each setting in detail.

#######################
##### Directories #####
#######################

##### REQUIRED #####
# Input Directory
idir: '/Users/wbalmer/JWST-HCI/HD114174/ROUND/JWST/'
odir: '/Users/wbalmer/JWST-HCI/HD114174/ROUND/output/' # Output Directory
sdir: '/Users/wbalmer/JWST-HCI/HD114174/vizier_votable.vot' #VOT table or stellar model file.

##### OPTIONAL #####
rundirs: ['2022_07_21_RDI_annu4_subs1_run3'] #'2022_06_06_RDI_annu1_subs1_run1'] #Specify directory(ies) within odir of existing runs to calculate contrast cuvre / companion
ancildir: None      # Specify directory to save ancillary files, if None then saved under odir/ANCILLARY/.
bg_sci_dir: None
bg_ref_dir: None

############################
##### General Settings #####
############################
verbose: True
plotting: True    # Produce matplotlib plots
use_psfmask: True # if true use PSF masks from CRDS, if false use transmission functions
fiducial_point_override: True # if true uses narrow end of the bar masks, if false use filter dependent position
overwrite: True   # Will overwrite existing files in a given directory
badpix_threshold: 1

########################################
##### Star / Companion information #####
########################################
spt: 'G5V' # Spectral type of target, only necessary for VOTable. Keep it simple.
ra_off: [19] # mas; RA offset of the known companions
de_off: [-479] # mas; DEC offset of the known companions

#################################
##### Ramp Fitting Settings #####
#################################
ramp_ext: 'uncal.fits'
skip_jump: False     #Whether to skip the jump detection step of the pipeline
jump_threshold: 20   #Adjust the jump detection threshold if not skipped

#####################################
##### Image Processing Settings #####
#####################################
imgproc_ext: 'rateints.fits'

####################################
##### PSF Subtraction Settings #####
####################################
sub_ext: 'calints.fits'
bgtrim: 'first'   # Trim the first integration in the background, science, and reference (bgsub != 'saved' or 'None')
bgsub: None    #Perform background subtraction, 'default' to match sci with bg_sci, ref with bg_ref, 'saved' to load saved
centering_alg: 'jwstpipe'    # Algorithm to use for centering "basic", "jwstpipe", "imageregis", or 'savefile'
mode: ['RDI']       # list of modes for pyKLIP, will loop through all
annuli: [4]         # list of number of annuli for pyKLIP, will loop through all
subsections: [1]    # list of number of annuli for pyKLIP, will loop through all
numbasis: [1, 2, 5, 10, 20, 50, 100] # list of number of basis vectors for pyKLIP, will loop through all

###################################
##### Contrast Curve Settings #####
###################################
usebgsub_contrast: True
usebgsub_companion: True
fwhm_scale: 1.5
repeatcentering_companion: False
KL: 20 # index of the KL component for which the calibrated contrast curve and the companion properties shall be computed

seps_inject_rnd: [5.0, 7.5, 10.0, 12.5, 15.0, 17.5, 20.0, 25., 30.0, 35.0, 40.0] # pix; list of separations at which fake planets shall be injected to compute the calibrated contrast curve for the round masks
#seps_inject_rnd: [5.0, 25.0, 40.0] # pix; list
pas_inject_rnd: [0., 45., 90., 135., 180., 225., 270., 315.] # deg; list of position angles at which fake planets shall be injected to compute the calibrated contrast curve for the round masks

pa_ranges_bar: [(105, 105), (285, 285)] # deg; list of tuples defining the pizza slices that shall be considered when computing the contrast curves for the bar masks
seps_inject_bar: [2.0, 4.0, 6.0, 8.0, 10.0, 12.5, 15.0, 17.5, 20.0, 25.0, 30.0] # pix; list of separations at which fake planets shall be injected to compute the calibrated contrast curve for the bar masks
pas_inject_bar: [45., 135., 225., 315.] # deg; list of position angles at which fake planets shall be injected to compute the calibrated contrast curve for the bar masks

#######################################################
##### Companion Photometry / Astrometry Settings ######
#######################################################
nested: True
mcmc: False
nwalkers:  100
nburn: 100
nsteps: 200
numthreads: 2

# new
x_range: 3. # pix
y_range: 3. # pix
flux_range: 10. # mag
corr_len_range: 3.
corr_len_guess: 3.
fitboxsize: 31 # pix
dr: 5
exc_rad: 3
